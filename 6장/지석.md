# 클라이언트 사이드 렌더링의 한계

1. SEO

자바스크립트도 크롤러가 색인할 수 있다. 하지만, 모든 컨텐츠가 온전히 채워진 상태로 전달되어야 하는데 리액트와 같은 csr은 텅 빈 html이 전달된다.
첫 요청 시 파일 전부가 로드되는 것이 아닌, 페이지를 읽어 들인 후 자바스크립트 요청을 해야한다.

2. 성능

느린 네트워크나 낮은 성능 기기에서 문제가 발생한다.
앱을 읽어들이는 시간이 늦기 때문이다. -> 서버에서 빈 html을 전달해서.

또 데이터를 가져오는 거리가 너무 멀다.

html 로딩 -> 자바스크립트 로딩 -> 초기 UI 렌더링 -> 페치 -> 리렌더링
불필요한 데이터 왕복이 너무 길다. 또 페치가 언제 끝날지 모름

이래서 ssr이 대두됨

ssr을 통해 껍데기와 컨텐츠를 채워서 클라이언트에 보내고 하이드레이션으로 상호작용하게 한다.

3. 보안

클라이언트와 서버는 서로 알지 못한다.
ssr을 하는 경우 서버에서 생성된 토큰으로 이런 문제를 해결할 수 있다.
csrf 공격 방지

# SSR의 부상

장점

1. FMP가 빨라진다.

바로 컨텐츠를 보게된다.

> 주의: Lighthouse 6.0에서는 유의미한 첫 페인트 (FMP)가 지원 중단되었습니다. 실제로 FMP는 페이지 로드의 작은 차이에 지나치게 민감하여 일관되지 않은(이중 모드) 결과가 발생했습니다. 또한 이 측정항목의 정의는 브라우저별 구현 세부정보에 의존하므로 모든 웹브라우저에서 표준화되거나 구현될 수 없습니다. 앞으로는 최대 콘텐츠 렌더링 시간 요소를 대신 사용하는 것이 좋습니다.

https://developer.chrome.com/docs/lighthouse/performance/first-meaningful-paint?hl=ko

자바스크립트를 추가로 로드할 시간이 필요 없다.
근데 어차피 서버컴포넌트가 없으면 요청은 또 다시 클라이언트에서 보내서 렌더링을 다시한다.
즉 쉘만 서버에서 동적으로 빠르게 그릴 수 있는 거지 데이터 로딩은 동일하게 진행해야한다.

2. 접근성 개선

미리 로드된 html을 반환하기에 ux적으로 좋다.

3. seo 개선

온전한 html을 읽어서 seo에 좋다.
근데 이것도 쉘만 읽는 거 아닌가

4. 보안 향상

# 하이드레이션

정적 html이 상호작용할 수 있게 하는 것

클라이언트 번들 로드 -> 이벤트 리스너 부착

해당 프로세스가 완료되면 상호작용이 가능하다.

하지만, 가상돔을 다시 그려서 실제돔가 또 한 번 비교해야한다. 이미 서버에서 렌더링을 마쳤는데도.
그리고 하이드레이션이 한 번 시작되면 막을 수 없었는데 all or nothing 18버전 이후 개선됨

선택적 하이드레이션이 가능하다.

- 18버전 이전

  - 모든 스크립트가 로드되고 하이드레이션이 끝나야 상호작용이 가능했다.

- 이후
  - 선택적 하이드레이션으로 로딩 중 상호작용이 일어나면 상호작용을 감지해 우선순위를 높인다.
  - TTI가 매우 높아짐
  - 동시성 기능 덕

https://github.com/reactwg/react-18/discussions/37ㄹ
https://www.joshwcomeau.com/react/server-components/

| API                    | 주요 특징                                 | 사용 환경               | 하이드레이션 | 추천 사용 사례                             |
| ---------------------- | ----------------------------------------- | ----------------------- | ------------ | ------------------------------------------ |
| renderToPipeableStream | 스트리밍, <Suspense>, 선택적 하이드레이션 | Node.js                 | O            | 최신 React 앱의 표준 SSR (Node.js 환경)    |
| renderToReadableStream | 스트리밍, <Suspense>, 선택적 하이드레이션 | 엣지 런타임 (웹 스트림) | O            | 엣지 컴퓨팅 환경에서의 SSR                 |
| renderToString         | 동기적, 단일 HTML 문자열                  | 모든 JavaScript 환경    | O            | 정적 사이트 생성(SSG), 레거시 SSR          |
| renderToStaticMarkup   | 동기적, 순수 HTML 문자열                  | 모든 JavaScript 환경    | X            | 이메일, PDF 등 비상호작용 정적 콘텐츠 생성 |
