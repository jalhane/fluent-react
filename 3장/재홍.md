# 3.1 가상 DOM 소개

- 실제 DOM은 브라우저 런타임의 문서 모델. 노드 객체로 구성
- 가상 DOM은 평범한 JS 객체로 구성
- UI를 변경하면 가상 DOM을 먼저 업데이트한 다음, 실제 DOM을 업데이트함. 이것이 reconciliation
- 실제 DOM이 업데이트 되면 리플로우가 진행되는데 리플로우는 렌더링 시 가장 많은 비용이 발생하는 작업. 가상 DOM은 실제 페이지를 변경하지 않기 때문에 훨씬 효율적으로 동작.
- 가상 DOM과 실제 DOM을 비교해서 업데이트에 필요한 최소의 변경 사항만 적용.

# 3.2 실제 DOM

문제점

- 성능
  - 크고 복잡한 웹에서 실제 DOM을 업데이트하면 리플로우 때문에 느리고 리소스를 많이 사용함.
- 브라우저 간 호환성
  - 브라우저 간 DOM 모델링 방식이 달라 웹 동작의 일관성이 보장되지 않고, 버그가 발생
  - 브라우저 간 특정 DOM 엘리먼트와 속성을 지원하지 않는 브라우저가 있을 수 있다.
  - 리액트의 synthetic event system 저굥
    - 브라우저의 기본 DOM 이벤트를 한번 감싸서(Wrapping), 모든 브라우저에서 동일하게 동작하도록 만든 리액트만의 표준화된 이벤트 객체
    - 해외여행용 멀티 어댑터

## Document Fragment

- DOM 노드를 저장하는 가벼운 컨테이너. 가상 DOM의 전신이라고 볼 수 있음
- DOM 업데이트를 batching하기 위해 사용하는 도구

```jsx
const framgent = document.createDocumentFragment();
for (let i = 0; i < 1000; i++) {
  const div = document.createElement("div");
  div.textContent = `Item ${i}`;
  fragment.appendChild(div);
}
document.body.appendChild(fragment);
```

- 1000개의 항목을 추가할 때 document fragment를 사용하면 DOM이 1000번이 아닌 1번만 업데이트된다.

| 특징              | DocumentFragment                             | Virtual DOM                                    |
| ----------------- | -------------------------------------------- | ---------------------------------------------- |
| **정의**          | 브라우저 네이티브 API, 경량 DOM 컨테이너     | JS 객체로 만든 DOM의 추상화, 프로그래밍 패턴   |
| **주요 목적**     | 여러 노드를 한 번에 DOM에 추가하기 위함      | 상태 변경에 따른 UI 업데이트를 최적화하기 위함 |
| **비교(Diffing)** | 없음                                         | 핵심 기능 (이전/이후 VDOM 비교)                |
| **상태 관리**     | 없음                                         | 핵심 기능 (상태와 UI를 동기화)                 |
| **사용 방식**     | 개발자가 직접 생성하고 수동으로 조작         | 프레임워크가 내부적으로 자동 처리              |
| **적합한 상황**   | 여러 요소를 DOM에 한 번에 삽입하는 단순 작업 | 복잡하고 동적인 UI 애플리케이션 개발           |

# 3.3 가상 DOM 작동 방식

`React.createElement` 를 사용하여 리액트 엘리먼트를 만듦

```jsx
const element = React.createElement("div", null, "Hello, World!");
```

```jsx
{
  $$typeof: Symbol(react.element),
  type: "div",
  key: null,
  ref: null,
  props: {
    children: "Hello, World!",
  },
  _owner: null,
  _store: {},
}
```

- $typeof: 객체가 유요한 리액트 엘리먼트인지 확인할 때 사용하는 실벌
- type: 엘리먼트가 나타내는 컴포넌트 종류 (string | function)
- ref: 보통 DOM을 직접 조작해야 하는 경우에 사용
- props: 컴포넌트에 전달된 모든 속성과 프롭을 포함하는 객체
- \_owner: 해당 엘리먼트를 생성한 컴포넌트를 추적하기 위한 프로퍼티
- \_store: 엘리먼트에 대한 추가 데이터를 저장하기 위해 리액트가 내부저긍로 사용하는 객체

가상 DOM과 실제 DOM 비교

- `React.createElement`는 리액트 엘리먼트를 `document.createElement`는 DOM 노드를 생성함
- `React.createElement` 는 메모리에 새로운 가상 엘리먼트를, `document.createElement` 는 DOM에 추가되기 전, 메모리에 새로운 엘리먼트를 생성함.

상태나 프롭이 변경되면 리액트는 업데이트된 새로운 리액트 엘리먼트 트리를 생성함. 생성한 트리와 이전 트리를 비교해 실제 DOM에 변경사항을 결정함 이때 **디핑** 알고리즘이 사용됨.

디핑 알고리즘은 실제 DOM에 적용해야 하는 변경 횟수의 최소화를 목표로함.
